<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<?rfc toc="yes"?>
<?rfc tocompact="yes"?>
<?rfc tocdepth="3"?>
<?rfc tocindent="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc comments="no"?>
<?rfc inline="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<rfc xmlns:xi="http://www.w3.org/2001/XInclude"  category="info" docName="draft-hegde-lsr-ospf-better-idbx"
     ipr="trust200902"
     obsoletes="" submissionType="IETF" updates="" xml:lang="en">
    <front>
        <title abbrev="draft-hegde-lsr-ospf-better-idbx">
            Trusted Domain SRv6
        </title>

        <author fullname="Shraddha Hegde" initials="S." surname="Hegde">
            <organization>Juniper</organization>
            <address>
                <postal>
                    <street>
                    </street>
                    <city></city>
                    <region>
                    </region>
                    <code/>
                    <country>India
                    </country>
                </postal>
                <phone/>
                <facsimile/>
                <email>shraddha@juniper.net
                </email>
                <uri/>
            </address>
        </author>
         <author fullname="Tony Przygienda" initials="A." surname="Przygienda">
            <organization>Juniper</organization>
            <address>
                <postal>
                    <street>1133 Innovation Way
                    </street>
                    <city>Sunnyvale</city>
                    <region>CA
                    </region>
                    <code/>
                    <country>USA
                    </country>
                </postal>
                <phone/>
                <facsimile/>
                <email>prz@juniper.net
                </email>
                <uri/>
            </address>
        </author>
         <author fullname="Acee Lindem" initials="A." surname="Lindem">
            <organization>LabN</organization>
            <address>
                <postal>
                    <street>
                    </street>
                    <city></city>
                    <region>
                    </region>
                    <code/>
                    <country>
                    </country>
                </postal>
                <phone/>
                <facsimile/>
                <email>acee.ietf@gmail.com
                </email>
                <uri/>
            </address>
        </author>
         
        <date year="2023"/>
        <abstract>
            <t>
                 When an OSPF router undergoes restart, the previous incarnations of the LSAs belonging to that router
                 still linger in the database of other routers in the OSPF domain until they are Maxaged. When the restarting
                 router comes back, neighboring routers establish adjacency with the restarting router while the 
                 restarting router is still bringing-up the interfaces and adjacencies. The combination of stale LSA
                 of the restarting router in the database and the new LSA from adjacenct routers may get interpreted as,
                 connectivity being established through the restarting router. This incorrect interpretation may cause
                 traffic blackhole. This document suggests improvements in the OSPF database exchange process to prevent
                 traffic blackhole due to stale LSA misinterpretation.
                 
                 
            </t>
        </abstract>
        <note title="Requirements Language">
            <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
                "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
                document are to be interpreted as described in <xref format="default"
                                                                     pageno="false" target="RFC2119">RFC 2119</xref>.
            </t>
        </note>
    </front>
    <middle>


        <section title="Introduction" anchor='sec_introduction'>        
            <t>
               When an OSPF <xref target ='RFC2328'/> router restarts, it's stale LSAs are left in the
               database of the other routers in the OSPF domain until the LSAs are MaxAged. The stale
                Router LSA contains links to all the neighbors that had adjacencies Up before the router
                 restarted.
                 <figure anchor="Topology_1" title="OSPF Network">
                 <artwork>
                            ----------C--------
                            |                 |
                      A-----B                 E-----F
                            |                 |
                            --------D---------                   
                      
                      
                 </artwork> 
                 </figure>
                 <xref target ='Topology_1'/> describes an OSPF network. When C undergoes restart, the other routers
                 in the domain hold the stale LSA of Router C in their database. The stale LSA may have links to B and E,
                 which represents the topology of C before it went down. When C comes up,
                 it initiates database exchange process with B and E. B and E have C's stale LSA with higher 
                 sequence number in their database and assume it is the latest copy and bring up the adjacency 
                 with C and go to Full state. Based on C's Stale LSA having B and E link in the LSA, back-link check is
                 satisfied and B and E update their routing table to point to C. This may cause traffic blackhole 
                 as C may not have the adjacency up and the routes programmed correctly.
                 
            </t>
        </section>
          <section title="Solution" anchor='sec_solution'>
               <t>
                    The database exchange procedure from <xref target ='RFC2328'/> section 7.2 is updated and additional
                    procedure added as below.</t>
                 <t>   
                    During Database exchange when a router receives an LSA from the neighbor where, neighbor is the originator
                    of the LSA and the sequence number of the LSA is smaller than it's own database copy, then the router marks
                    it's own database copy as stale. Router sends LSReq for the LSA (the one marked stale) with the
                      received sequence number. Until an LSA with
                    the sequence number greater than it's own database copy is received, this LSReq MUST not be satisfied and the neighborship
                      MUST NOT move to Full state.</t>
               <section title="Example" anchor='sec_ex'>
                    <t> Let us take an example when C is restarting. Let us take an example where C has originated an LSA with sequence number
                         Y before restarting. After restarting C orginates the same LSA with sequence number X where X < Y.
                         <figure anchor="seq_dgm" title="Modified Database Exchange Procedure">
                         <artwork>
                              
                                                  C-----------------E                                                  
                              
                                              DBD: LSA A origin:C  ------->
                                                  Sequence:X
                                                                      DBD: LSA A Origin:C
                                                              <------       Sequence:Y
                                              LSReq LSA A, 
                                              origin C, Seq Y----->
                                                                    Modified Procedure
                                                             <------ LSReq LSA A, Origin C, Seq X
                                              LSA A, Origin C,
                                              Seq:X          ------->
                                                             <------- LSA  A, Origin C, Seq:Y
                                              C re-originating self LSA                        
                                              LSA A, Origin C, -------> Mark LSReq 
                                              Seq:Y+1                    LSAA, Origin C, Seq X 
                                                                          Satisfied
                                            
                         </artwork>
                         </figure>
                         As described in the figure <xref target ='seq_dgm'/> above, E places LSReq with Sequence number X but
                         waits until the LSA with sequence number Y+1 arrives. As the LSA is still in the LSReq queue, the adjacency
                         will remain in Loading state and will not move to Full state. All the neighbors of the restarting routers 
                         hold the neighborship in Loading state and do not make it Full until the stale LSA is replaced with the new LSA
                         with higher sequence number than the stale LSA. This ensures that other routers in the network do not compute
                         a path through the restarting router. 
                    </t>
               </section>

        <section title="Glossary" >
            <dl newline="true" spacing="normal">

                <dt>Fail-Closed Domain:</dt>
                <dd>
                    synonymous with a Trusted Domain.
                </dd>


            </dl>

        </section>

        <section title=".">

        </section>




        <section anchor="registry" title="Registry Considerations">
            <section anchor="IANA" title="IANA Considerations" toc="default">

                <t>
                    No IANA Considerations
                </t>
            </section>



        </section>

        <section title="Security Considerations">
            <t>
            </t>
        </section>

        <section title="Contributors">
            <t></t>
        </section>

    </middle>
    <back>
        <references title="Informative References">

        </references>
        <references title="Normative References">
            <xi:include href="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml"/>
            <xi:include href="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.8402.xml"/>
            <xi:include href="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.2328.xml"/>
           

        </references>

    </back>
</rfc>
